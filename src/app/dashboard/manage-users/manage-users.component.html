<div class="users-page">
  <h1 class="page-title">Users</h1>

  @if (storeError()) {
    <div class="error-banner" role="alert">
      <div class="error-content">
        <span class="error-icon">⚠️</span>
        <span class="error-message">{{ storeError() }}</span>
        <button type="button" class="error-close" (click)="clearStoreError()" aria-label="Close error">×</button>
      </div>
    </div>
  }

  <app-user-table
    [users]="paginatedUsers()"
    [currentPage]="currentPage()"
    [totalPages]="totalPages()"
    [canGoPrevious]="canGoPrevious()"
    [canGoNext]="canGoNext()"
    (editUser)="openEdit($event)"
    (previousPage)="previousPage()"
    (nextPage)="nextPage()"
  />
</div>

@if (editPopupVisible() && editingUser) {
  <div class="popup-backdrop" (click)="onBackdropClick($event)">
    <div class="popup popup-edit" role="dialog" aria-labelledby="edit-user-title">
      <h2 id="edit-user-title" class="popup-title">Edit User</h2>

      @if (editError()) {
        <div class="error-message" role="alert">
          {{ editError() }}
        </div>
      }

      <div class="form-group">
        <label for="edit-name">Name <span class="required">*</span></label>
        <input id="edit-name" type="text" [(ngModel)]="editName" class="input" placeholder="Full name" required />
      </div>
      <div class="form-group">
        <label for="edit-email">Email</label>
        <input
          id="edit-email"
          type="text"
          [value]="editingUser.email"
          class="input input-readonly"
          readonly
          aria-readonly="true"
        />
        <p class="field-hint">Email cannot be changed (unique key).</p>
      </div>
      <div class="form-group">
        <label for="edit-items">Items Purchased</label>
        <input id="edit-items" type="number" [(ngModel)]="editItemsPurchased" min="0" step="1" class="input" />
      </div>
      <div class="form-actions">
        <button type="button" class="btn btn-secondary" (click)="closeEdit()">Cancel</button>
        <button type="button" class="btn btn-primary" (click)="saveEdit()">Save</button>
      </div>
    </div>
  </div>
}
